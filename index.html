<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨æ·¡æ°´ï¼Œç·´ç¿’å’Œä½ ä¸€èµ·ç”Ÿæ´» ğŸŒ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        :root { --bg-color: #FDF6E3; --primary-color: #E58E58; --secondary-color: #5F8575; --text-color: #433431; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); color: var(--text-color); overflow-x: hidden; }
        .card { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(12px); }
        .btn-option { transition: all 0.2s; border: 2px solid #F1ECE1; text-align: left; }
        .btn-option:hover { border-color: var(--primary-color); background-color: #FFF9F2; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:disabled { background-color: #ccc; cursor: not-allowed; }
        .progress-inner { height: 100%; background: var(--secondary-color); transition: width 0.3s; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="app" class="max-w-md w-full card rounded-[2.5rem] shadow-2xl p-8 border-t-8 border-[#E58E58]">
        
        <div id="start-screen" class="text-center">
            <h1 class="text-2xl font-bold mb-1 tracking-wider">åœ¨æ·¡æ°´ï¼Œç·´ç¿’å’Œä½ ä¸€èµ·ç”Ÿæ´»</h1>
            <h2 class="text-[10px] text-[#5F8575] font-bold mb-6 uppercase tracking-[0.2em]">Our Cohabitation Manifesto</h2>

            <div class="bg-[#F8F3E9] p-6 rounded-3xl border border-[#EEE] text-left text-xs text-gray-500 leading-relaxed mb-8 shadow-sm">
                <div id="welcome-msg" class="space-y-3"></div>
                <div class="mt-4 p-2 bg-white rounded-lg border border-orange-100 text-[10px] text-orange-500 font-bold">
                    âš ï¸ å°æé†’ï¼šç”±æ–¼åˆ†äº«ç¶²å€æœ‰é•·åº¦é™åˆ¶ï¼Œé–‹æ”¾é¡Œè«‹ä¿æŒåœ¨ 50 å­—å…§ï¼Œç²¾ç°¡æ ¸å¿ƒæƒ³æ³•å³å¯ï¼Œç´°ç¯€ç•™å¾…è¦‹é¢è¨è«–å–”ï¼
                </div>
            </div>

            <button onclick="startQuiz()" class="w-full py-4 rounded-2xl btn-primary font-bold text-lg shadow-lg">é–‹å•Ÿå°é½Šè¨ˆç•«</button>
        </div>

        <div id="quiz-screen" class="hidden text-center">
            <div class="mb-6">
                <div id="progress-text" class="text-[9px] font-bold text-gray-400 mb-2 uppercase tracking-widest">QUESTION 1 / 23</div>
                <div class="h-1 w-full bg-gray-100 rounded-full overflow-hidden">
                    <div id="progress-inner" class="progress-inner" style="width: 5%"></div>
                </div>
            </div>
            <h2 id="question-text" class="text-lg font-bold mb-8 leading-snug text-gray-800">è¼‰å…¥ä¸­...</h2>
            <div id="options" class="space-y-3"></div>
            
            <div id="custom-input-area" class="mt-4 hidden text-left">
                <textarea id="custom-text" rows="4" maxlength="50" oninput="updateCharCount()" 
                          placeholder="åœ¨é€™è£¡åˆ†äº«å¦³/ä½ çš„æƒ³æ³•..." 
                          class="w-full p-4 border-2 border-dashed border-gray-200 rounded-2xl text-sm focus:border-[#E58E58] outline-none resize-none bg-white"></textarea>
                <div class="flex justify-between mt-2 px-1">
                    <span id="char-count" class="text-[10px] text-gray-400">0 / 50 å­—</span>
                    <span class="text-[10px] text-[#E58E58]">è¶…é 50 å­—æœƒå°è‡´ç¶²å€å¤±æ•—å–”</span>
                </div>
                <button id="custom-submit-btn" onclick="handleCustomSubmit()" class="w-full mt-4 py-3 bg-[#5F8575] text-white rounded-xl font-bold text-sm">ç¢ºèªé€™é¡Œ</button>
            </div>
        </div>

        <div id="share-screen" class="hidden text-center">
            <div class="text-5xl mb-6">âœ‰ï¸</div>
            <h2 class="text-xl font-bold mb-4">å¦³çš„éƒ¨åˆ†å·²å®Œæˆï¼</h2>
            <p class="text-gray-500 mb-8 text-xs leading-relaxed">æˆ‘å·²ç¶“æŠŠå¦³çš„æƒ³æ³•å£“ç¸®å¥½å›‰ã€‚<br>è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•è¤‡è£½é€£çµå‚³çµ¦ä»–ï¼</p>
            <button onclick="copyLink()" class="w-full py-4 btn-primary rounded-2xl font-bold shadow-lg">è¤‡è£½é€£çµå‚³çµ¦ä»–</button>
            <input id="share-url-hidden" type="text" class="absolute -top-full left-0 opacity-0">
        </div>

        <div id="result-screen" class="hidden">
            <div id="capture-area" class="bg-white p-6 rounded-3xl">
                <div class="text-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800 italic">Our Sweet Home Manifesto</h2>
                </div>
                <div id="result-list" class="space-y-4 max-h-[50vh] overflow-y-auto pr-1 custom-scrollbar text-left"></div>
            </div>
            <button onclick="downloadImage()" class="w-full py-4 mt-8 bg-[#5F8575] text-white rounded-2xl font-bold shadow-md">ğŸ“¸ å„²å­˜çµæœåœ–</button>
        </div>
    </div>

    <script>
        // é¡Œåº«èˆ‡é‚è¼¯ä¿æŒèˆ‡å‰æ¬¡ä¸€è‡´ï¼Œåƒ…å¢åŠ å­—æ•¸ç›£è½
        const questions = [
            { q: "å°æ–¼æ—¥å¸¸æ¶ˆè²»ï¼Œå¦‚åƒé£¯/ç´„æœƒèª°ä»˜éŒ¢çš„æƒ³æ³•ï¼Ÿ", options: ["å¸Œæœ› AA ç•¶æ—¥çµç®—", "AB è¼ªæµç…§é¡§å½¼æ­¤", "ä¸ç”¨åˆ†å¤ªç´°ï¼Œéš¨æ€§å°±å¥½"], type: "choice" },
            { q: "é—œæ–¼å…±åŒéŒ¢åŒ…ï¼Œå¦³/ä½ çš„æƒ³æ³•æ˜¯ï¼Ÿ", options: ["æ”¯æŒï¼æ¯æœˆå›ºå®šå­˜å…¥", "ä¸ç”¨è¨­å¸³æˆ¶ï¼Œå…ˆä»˜å†è«‹æ¬¾", "æœˆåº•ä¸€æ¬¡çµç®—", "ä¸ç”¨åˆ†å¤ªç´°ï¼Œéš¨æ€§å°±å¥½"], type: "choice" },
            { q: "å¸Œæœ›ã€Œå¤–é£Ÿã€èˆ‡ã€Œä¸‹å»šã€çš„é–‹éŠ·åˆ†é…ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚ä¸‹å»šå…¬è²»ï¼Œå¤–é£Ÿè¼ªæµ..." },
            { q: "å¸Œæœ›å®¶äº‹å¦‚ä½•é‹ä½œï¼Ÿ", options: ["æ¯é€±è¼ªæµ", "å„è‡ªèªé ˜é …ç›®", "ä¸»å‹•æ¥çƒåˆ¶", "ä¸€èµ·åšï¼å›ºå®šå®¶äº‹æ™‚é–“"], type: "choice" },
            { q: "å®¶äº‹å¤§é»åï¼æœ€ä¸æ’æ–¥å“ªå¹¾é …ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šå¦‚æ´—ç¢—ã€å€’åƒåœ¾..." },
            { q: "å°ã€Œé›œç‰©äº‚ä¸Ÿã€çš„å®¹å¿åº¦æ˜¯ï¼Ÿ", options: ["çµ•å°ä¸è¡Œ", "å¯ä»¥æ”¾2-3å¤©", "ä¸å½±éŸ¿èµ°è·¯éƒ½èƒ½å¿", "æˆ‘æ˜¯äº‚ä¸Ÿçš„é‚£å€‹äºº"], type: "choice" },
            { q: "å°ã€Œåœ°é¢æ•´æ½”åº¦ã€çš„å®¹å¿åº¦æ˜¯ï¼Ÿ", options: ["æ¯é€±å¸åœ°", "çœ‹åˆ°é«’å°±å¸", "æœ‰ç©ºå†å¸"], type: "choice" },
            { q: "æ°´æ§½è£¡çš„é«’ç¢—ç›¤å¯ä»¥ç•™å¤šä¹…ï¼Ÿ", options: ["åƒå®Œé¦¬ä¸Šæ´—", "ç¡å‰æ´—å®Œ", "éš”å¤©æ—©ä¸Šå†èªª"], type: "choice" },
            { q: "é—œæ–¼æ´—è¡£æœçš„ã€Œç´°ç¯€ã€ç¿’æ…£ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚è¥ªå­å¿…é ˆåˆ†é–‹..." },
            { q: "ç•¶ä½œæ¯ä¸ä¸€è‡´æ™‚ï¼Œå¸Œæœ›å°æ–¹æ€éº¼åšï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚é¬§é˜èª¿ä¸€å€‹..." },
            { q: "æˆ‘éœ€è¦ã€Œè²“å’ªæ™‚é–“ã€ä¸è¦æ‰“æ“¾çš„è¨Šè™Ÿï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚æˆ´è€³æ©Ÿ..." },
            { q: "é›™æ–¹éƒ½åœ¨å®¶å·¥ä½œæ™‚çš„éœ€æ±‚ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚è¦–è¨Šé¿é–‹..." },
            { q: "æƒ…ç·’ä½è½æ™‚ï¼Œå¸Œæœ›å°æ–¹...", options: ["ä¸»å‹•ç™¼ç¾ï¼†å®‰æ…°", "æƒ³è‡ªå·±æ¶ˆåŒ–", "å¸Œæœ›æœ‰æ„›çš„æŠ±æŠ±"], type: "choice" },
            { q: "å°æ–¼å…±äº«è¡Œäº‹æ›†ä½ çš„æƒ³æ³•æ˜¯ï¼Ÿ", options: ["æŒæ§ç”Ÿæ´»ç¯€å¥", "å½ˆæ€§æ¯é€±å°ç„¦", "ä»¥å€‹äººè¦åŠƒç‚ºä¸»"], type: "choice" },
            { q: "æœ‹å‹æƒ³ä¾†å®¶è£¡ç©ï¼Œæå‰å¤šä¹…å‘ŠçŸ¥ï¼Ÿ", options: ["è‡³å°‘ä¸€å¤©å‰", "ä¸€å°æ™‚å‰", "éš¨æ™‚æ­¡è¿", "å„˜é‡ä¸è¦å¸¶äººå›ä¾†"], type: "choice" },
            { q: "é—œæ–¼ã€Œæœ‹å‹ç•™å®¿ã€çš„è¦å®šï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚é »ç‡ã€å°è±¡..." },
            { q: "åµæ¶æ™‚çµ•å°ä¸å¯ä»¥åšçš„äº‹ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚ä¸èƒ½å†·æš´åŠ›..." },
            { q: "åµæ¶éœ€è¦å†·éœæ™‚é–“å—ï¼Ÿ", options: ["å¸Œæœ›é¦¬ä¸Šè¬›é–‹", "å†·éœä¸€ä¸‹ä¸‹å†èŠ", "éœ€è¦æ¶ˆå¤±ä¸€æ®µæ™‚é–“"], type: "choice" },
            { q: "æ˜¯å¦åŒæ„ä¸å¸¶æƒ…ç·’éå¤œï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šåºŠé ­åµåºŠå°¾å’Œï¼Ÿ" },
            { q: "åŒå±…å¾Œçš„å„€å¼æ„Ÿï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚ç´„æœƒæ—¥ã€èŠèŠå¤©..." },
            { q: "ä½ æœƒå¦‚ä½•å®šç¾©ä¸€èµ·ä½ï¼Ÿå°æ¥ä¸‹ä¾†çš„æœŸå¾…", type: "input", placeholder: "50å­—å…§çš„å¿ƒè£¡è©±" },
            { q: "å¸Œæœ›ç‚ºæœŸå¤šä¹…çš„åŒå±…ï¼Ÿä½•æ™‚å›é ­æª¢è¦–ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šå¦‚åŠå¹´ã€ä¸€å¹´..." },
            { q: "è‹¥æœªä¾†ç™¼ç¾çœŸçš„ä¸é©åˆï¼Œé€€å ´æ©Ÿåˆ¶æ˜¯ï¼Ÿ", type: "input", placeholder: "50å­—å…§ï¼šä¾‹å¦‚å…ˆåˆ†å±…ã€æ¬å®¶..." }
        ];

        let partnerAnswers = null;
        let myAnswers = [];
        let currentQ = 0;

        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const data = urlParams.get('ans');
            const welcome = document.getElementById('welcome-msg');
            if (data) {
                try {
                    partnerAnswers = JSON.parse(LZString.decompressFromEncodedURIComponent(data));
                    welcome.innerHTML = `<p>å˜¿ï¼Œé€™æ˜¯ä¸€å ´é—œæ–¼ã€Œæˆ‘å€‘ã€çš„å°è©±ã€‚æˆ‘å·²ç¶“å¯«å¥½äº†ï¼Œæ›ä½ åˆ†äº«ä½ çš„æƒ³æ³•â¤ï¸</p>`;
                } catch(e) {
                    welcome.innerHTML = `<p class="text-red-500">ç¶²å€è®€å–å¤±æ•—ã€‚å¯èƒ½æ˜¯é€£çµå¤ªé•·è¢«é€šè¨Šè»Ÿé«”æˆªæ–·äº†ï¼Œè«‹å¦ä¸€åŠç²¾ç°¡å…§å®¹å¾Œé‡æ–°å‚³é€é€£çµå–”ï¼</p>`;
                }
            } else {
                welcome.innerHTML = `<p>æˆ‘å€‘è¦ä¸€èµ·åœ¨æ·¡æ°´å±•é–‹æ–°ç”Ÿæ´»äº†ã€‚ç‚ºäº†è®“æœªä¾†æ¯ä¸€å¤©éƒ½åƒå¤•é™½ä¸€æ¨£æš–å¿ƒï¼Œæˆ‘æº–å‚™äº†é€™ä»½å°å•å·ã€‚é€™ä¸æ˜¯è€ƒè©¦ï¼Œè€Œæ˜¯é—œæ–¼æˆ‘å€‘çš„ç·´ç¿’â¤ï¸</p>`;
            }
        };

        function startQuiz() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            showQuestion();
        }

        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('progress-text').innerText = `QUESTION ${currentQ + 1} / ${questions.length}`;
            document.getElementById('progress-inner').style.width = `${((currentQ+1)/questions.length)*100}%`;
            document.getElementById('question-text').innerText = q.q;
            const optionsDiv = document.getElementById('options');
            const inputArea = document.getElementById('custom-input-area');
            optionsDiv.innerHTML = '';
            
            if (q.type === 'choice') {
                inputArea.classList.add('hidden');
                q.options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = "w-full p-4 rounded-xl btn-option text-sm";
                    btn.innerText = opt;
                    btn.onclick = () => saveAnswer(opt);
                    optionsDiv.appendChild(btn);
                });
            } else {
                inputArea.classList.remove('hidden');
                const textarea = document.getElementById('custom-text');
                textarea.value = '';
                textarea.placeholder = q.placeholder;
                updateCharCount();
            }
        }

        function updateCharCount() {
            const val = document.getElementById('custom-text').value;
            document.getElementById('char-count').innerText = `${val.length} / 50 å­—`;
        }

        function handleCustomSubmit() {
            const val = document.getElementById('custom-text').value.trim();
            if (!val) return alert("åˆ†äº«ä¸€é»æƒ³æ³•å˜›ï½");
            if (val.length > 50) return alert("å…§å®¹å¤ªé•·å›‰ï¼Œè«‹æ§åˆ¶åœ¨ 50 å­—å…§ï¼");
            saveAnswer(val);
        }

        function saveAnswer(ans) {
            myAnswers.push(ans);
            if (currentQ < questions.length - 1) {
                currentQ++;
                showQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            document.getElementById('quiz-screen').classList.add('hidden');
            if (partnerAnswers) {
                showResult();
            } else {
                const ansString = LZString.compressToEncodedURIComponent(JSON.stringify(myAnswers));
                const shareUrl = window.location.origin + window.location.pathname + '?ans=' + ansString;
                document.getElementById('share-url-hidden').value = shareUrl;
                document.getElementById('share-screen').classList.remove('hidden');
            }
        }

        function showResult() {
            document.getElementById('result-screen').classList.remove('hidden');
            const list = document.getElementById('result-list');
            list.innerHTML = '';
            const len = Math.min(questions.length, partnerAnswers.length, myAnswers.length);
            for(let i=0; i<len; i++) {
                const match = myAnswers[i] === partnerAnswers[i];
                list.innerHTML += `
                    <div class="p-4 rounded-2xl mb-3 border ${match ? 'border-green-100 bg-green-50' : 'border-orange-100 bg-orange-50'}">
                        <p class="font-bold text-[10px] mb-2 text-gray-700">${i+1}. ${questions[i].q}</p>
                        <div class="grid grid-cols-2 gap-2 text-[9px]">
                            <div class="bg-white/80 p-2 rounded-lg break-words">ğŸ‘§ï¼š${myAnswers[i]}</div>
                            <div class="bg-white/80 p-2 rounded-lg break-words">ğŸ‘¦ï¼š${partnerAnswers[i]}</div>
                        </div>
                    </div>`;
            }
        }

        function downloadImage() {
            html2canvas(document.getElementById('capture-area'), { backgroundColor: "#FFFFFF", scale: 2 }).then(canvas => {
                const link = document.createElement('a');
                link.download = `Home_Manifesto.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        function copyLink() {
            const el = document.getElementById("share-url-hidden");
            el.select();
            document.execCommand("copy");
            alert("é€£çµå·²è¤‡è£½ï¼");
        }
    </script>
</body>
</html>
